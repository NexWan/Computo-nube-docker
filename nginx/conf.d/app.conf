server {
    listen 80;
    server_name localhost;

    # Página estática en /
    root /usr/share/nginx/html;
    index index.html index.htm;

    # Redirige /usuarios -> /usuarios/
    location = /usuarios {
        return 301 /usuarios/;
    }

    # Tu app PHP vive físicamente en /var/www/usuarios (en ambos contenedores)
    # Usamos alias para mapear /usuarios/... -> /var/www/usuarios/...
    location ^~ /usuarios/ {
        alias /var/www/usuarios/;
        index index.php index.html;

        # Primero intenta archivo/carpeta; si no, pasa a index.php (front controller típico)
        try_files $uri $uri/ /usuarios/index.php?$args;

        # Solo pasar .php al FPM
        location ~ ^/usuarios/(.+\.php)$ {
            include fastcgi_params;
            fastcgi_pass app:9000;

            # Con 'alias' lo correcto es $request_filename (ya resuelto) o 'alias' + $1
            fastcgi_param SCRIPT_FILENAME $request_filename;

            # Mantén lo estándar
            fastcgi_param QUERY_STRING $query_string;
            fastcgi_param REQUEST_METHOD $request_method;
            fastcgi_param CONTENT_TYPE $content_type;
            fastcgi_param CONTENT_LENGTH $content_length;
        }
    }

    # Evita ejecutar PHP fuera de /usuarios/
    location ~ \.php$ { return 404; }
}
